<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BaZi Destiny Analysis</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        /* Language selector styles */
        .language-selector {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }

        .language-btn {
            background: #fff;
            border: 1px solid #ddd;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }

        .language-btn:hover {
            background: #f5f5f5;
        }

        .language-options {
            display: none;
            position: absolute;
            top: 100%;
            right: 0;
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-top: 4px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .language-options.show {
            display: block;
        }

        .language-option {
            padding: 8px 16px;
            cursor: pointer;
            white-space: nowrap;
            font-size: 14px;
        }

        .language-option:hover {
            background: #f5f5f5;
        }

        .current-lang-icon {
            width: 16px;
            height: 16px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="language-selector">
            <button class="language-btn" onclick="toggleLanguageOptions()">
                <span class="current-lang-icon">ğŸŒ</span>
                <span class="current-lang-text">English</span>
            </button>
            <div class="language-options" id="languageOptions">
                <div class="language-option" onclick="changeLanguage('en')">English</div>
                <div class="language-option" onclick="changeLanguage('zh')">ä¸­æ–‡</div>
            </div>
        </div>
        
        <header class="header">
            <h1 data-i18n="title">å…«å­—å‘½ç†åˆ†æ</h1>
            <p data-i18n="subtitle">æ¢ç´¢å‘½ç†ï¼Œå¯»æ‰¾äººç”Ÿæ–¹å‘</p>
        </header>

        <main>
            <section class="form-section">
                <form id="baziForm">
                    <div class="form-group">
                        <label for="birthdate" data-i18n="birthdate_label">å‡ºç”Ÿæ—¥æœŸæ—¶é—´</label>
                        <input type="datetime-local" id="birthdate" name="birthdate" required
                               min="1900-01-01T00:00" max="2100-12-31T23:59">
                    </div>

                    <div class="form-group">
                        <label for="gender" data-i18n="gender_label">æ€§åˆ«</label>
                        <select id="gender" name="gender" required>
                            <option value="" data-i18n="gender_select">è¯·é€‰æ‹©æ€§åˆ«</option>
                            <option value="male" data-i18n="gender_male">ç”·</option>
                            <option value="female" data-i18n="gender_female">å¥³</option>
                        </select>
                    </div>

                    <div class="form-buttons">
                        <button type="submit" class="submit-button" data-i18n="analyze_btn">å¼€å§‹åˆ†æ</button>
                        <button type="button" class="reset-button" onclick="resetForm()" data-i18n="reset_btn">é‡æ–°å¡«å†™</button>
                    </div>
                </form>
            </section>

            <section id="result" class="result-section">
                <!-- ç»“æœå°†é€šè¿‡JavaScriptåŠ¨æ€å¡«å…… -->
            </section>
        </main>
    </div>

    <!-- Import i18n configuration -->
    <script src="js/i18n.js"></script>
    <!-- Import language functions -->
    <script src="js/language.js"></script>
    <script>
        // å¤©å¹²
        const HEAVENLY_STEMS = ['ç”²', 'ä¹™', 'ä¸™', 'ä¸', 'æˆŠ', 'å·±', 'åºš', 'è¾›', 'å£¬', 'ç™¸'];

        // åœ°æ”¯
        const EARTHLY_BRANCHES = ['å­', 'ä¸‘', 'å¯…', 'å¯', 'è¾°', 'å·³', 'åˆ', 'æœª', 'ç”³', 'é…‰', 'æˆŒ', 'äº¥'];

        // äº”è¡Œ
        const FIVE_ELEMENTS = {
            'ç”²': 'æœ¨', 'ä¹™': 'æœ¨',
            'ä¸™': 'ç«', 'ä¸': 'ç«',
            'æˆŠ': 'åœŸ', 'å·±': 'åœŸ',
            'åºš': 'é‡‘', 'è¾›': 'é‡‘',
            'å£¬': 'æ°´', 'ç™¸': 'æ°´',
            'å­': 'æ°´', 'ä¸‘': 'åœŸ',
            'å¯…': 'æœ¨', 'å¯': 'æœ¨',
            'è¾°': 'åœŸ', 'å·³': 'ç«',
            'åˆ': 'ç«', 'æœª': 'åœŸ',
            'ç”³': 'é‡‘', 'é…‰': 'é‡‘',
            'æˆŒ': 'åœŸ', 'äº¥': 'æ°´'
        };

        // æ·»åŠ å†œå†è½¬æ¢ç›¸å…³çš„å¸¸é‡
        const LUNAR_INFO = [
            0x04bd8, 0x04ae0, 0x0a570, 0x054d5, 0x0d260, 0x0d950, 0x16554, 0x056a0, 0x09ad0, 0x055d2,
            0x04ae0, 0x0a5b6, 0x0a4d0, 0x0d250, 0x1d255, 0x0b540, 0x0d6a0, 0x0ada2, 0x095b0, 0x14977,
            0x04970, 0x0a4b0, 0x0b4b5, 0x06a50, 0x06d40, 0x1ab54, 0x02b60, 0x09570, 0x052f2, 0x04970,
            0x06566, 0x0d4a0, 0x0ea50, 0x06e95, 0x05ad0, 0x02b60, 0x186e3, 0x092e0, 0x1c8d7, 0x0c950,
            0x0d4a0, 0x1d8a6, 0x0b550, 0x056a0, 0x1a5b4, 0x025d0, 0x092d0, 0x0d2b2, 0x0a950, 0x0b557
        ];

        const CHINESE_NUMBERS = ['é›¶', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­', 'ä¸ƒ', 'å…«', 'ä¹', 'å'];
        const CHINESE_MONTHS = ['æ­£', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­', 'ä¸ƒ', 'å…«', 'ä¹', 'å', 'å†¬', 'è…Š'];
        const CHINESE_DAYS = ['åˆ', 'å', 'å»¿', 'ä¸‰'];
        const CHINESE_HOURS = {
            'å­': '23:00-01:00',
            'ä¸‘': '01:00-03:00',
            'å¯…': '03:00-05:00',
            'å¯': '05:00-07:00',
            'è¾°': '07:00-09:00',
            'å·³': '09:00-11:00',
            'åˆ': '11:00-13:00',
            'æœª': '13:00-15:00',
            'ç”³': '15:00-17:00',
            'é…‰': '17:00-19:00',
            'æˆŒ': '19:00-21:00',
            'äº¥': '21:00-23:00'
        };

        // è½¬æ¢æ•°å­—ä¸ºä¸­æ–‡æ•°å­—
        function numberToChinese(num) {
            if (num <= 10) return CHINESE_NUMBERS[num];
            if (num < 20) return 'å' + (num > 10 ? CHINESE_NUMBERS[num - 10] : '');
            return CHINESE_NUMBERS[Math.floor(num / 10)] + 'å' + (num % 10 ? CHINESE_NUMBERS[num % 10] : '');
        }

        // è·å–å†œå†æœˆä»½
        function getLunarMonth(month) {
            return CHINESE_MONTHS[month - 1] + 'æœˆ';
        }

        // è·å–å†œå†æ—¥æœŸ
        function getLunarDay(day) {
            if (day === 10) return 'åˆå';
            if (day === 20) return 'äºŒå';
            if (day === 30) return 'ä¸‰å';
            
            const tens = Math.floor(day / 10);
            const ones = day % 10;
            return CHINESE_DAYS[tens] + (ones === 0 ? 'å' : CHINESE_NUMBERS[ones]);
        }

        // è·å–æ—¶è¾°æè¿°
        function getTimeDescription(hour) {
            const branch = getHourBranch(hour);
            return `${branch}æ—¶ï¼ˆ${CHINESE_HOURS[branch]}ï¼‰`;
        }

        // ç”Ÿæˆå®Œæ•´çš„å¤é£æ—¥æœŸæè¿°
        function generateTraditionalDate(date) {
            const year = date.getFullYear();
            const month = date.getMonth() + 1;
            const day = date.getDate();
            const hour = date.getHours();

            const yearStem = getYearStem(year);
            const yearBranch = getYearBranch(year);
            const monthStem = getMonthStem(yearStem, month);
            const monthBranch = getMonthBranch(month);
            const dayStem = getDayStem(year, month, day);
            const dayBranch = getDayBranch(year, month, day);
            const hourStem = getHourStem(dayStem, hour);
            const hourBranch = getHourBranch(hour);

            return {
                yearText: `${yearStem}${yearBranch}å¹´ Â· å…¬å…ƒ${numberToChinese(Math.floor(year / 1000))}${numberToChinese(Math.floor((year % 1000) / 100))}${numberToChinese(Math.floor((year % 100) / 10))}${numberToChinese(year % 10)}å¹´`,
                monthText: `${monthStem}${monthBranch}æœˆ Â· ${getLunarMonth(month)}`,
                dayText: `${dayStem}${dayBranch}æ—¥ Â· ${getLunarDay(day)}`,
                hourText: `${hourStem}${hourBranch}æ—¶ Â· ${getTimeDescription(hour)}`
            };
        }

        // è·å–å¹´æŸ±å¤©å¹²
        function getYearStem(year) {
            return HEAVENLY_STEMS[(year - 4) % 10];
        }

        // è·å–å¹´æŸ±åœ°æ”¯
        function getYearBranch(year) {
            return EARTHLY_BRANCHES[(year - 4) % 12];
        }

        // è·å–æœˆæŸ±å¤©å¹²
        function getMonthStem(yearStem, month) {
            const stemIndex = (HEAVENLY_STEMS.indexOf(yearStem) * 2 + month + 1) % 10;
            return HEAVENLY_STEMS[stemIndex];
        }

        // è·å–æœˆæŸ±åœ°æ”¯
        function getMonthBranch(month) {
            return EARTHLY_BRANCHES[(month + 1) % 12];
        }

        // è·å–æ—¥æŸ±å¤©å¹²
        function getDayStem(year, month, day) {
            const g = 4 * year + Math.floor(year / 4) + 5 * month + day - 3;
            return HEAVENLY_STEMS[g % 10];
        }

        // è·å–æ—¥æŸ±åœ°æ”¯
        function getDayBranch(year, month, day) {
            const z = 8 * year + Math.floor(year / 4) + 5 * month + day + 7;
            return EARTHLY_BRANCHES[z % 12];
        }

        // è·å–æ—¶æŸ±å¤©å¹²
        function getHourStem(dayStem, hour) {
            const dayIndex = HEAVENLY_STEMS.indexOf(dayStem);
            const timeIndex = Math.floor((hour + 1) / 2) % 12;
            return HEAVENLY_STEMS[(dayIndex * 2 + timeIndex) % 10];
        }

        // è·å–æ—¶æŸ±åœ°æ”¯
        function getHourBranch(hour) {
            if (hour >= 23 || hour < 1) return 'å­';
            else if (hour < 3) return 'ä¸‘';
            else if (hour < 5) return 'å¯…';
            else if (hour < 7) return 'å¯';
            else if (hour < 9) return 'è¾°';
            else if (hour < 11) return 'å·³';
            else if (hour < 13) return 'åˆ';
            else if (hour < 15) return 'æœª';
            else if (hour < 17) return 'ç”³';
            else if (hour < 19) return 'é…‰';
            else if (hour < 21) return 'æˆŒ';
            else return 'äº¥';
        }

        // åˆ†æå…«å­—
        function analyzeBaZi(birthdate) {
            const year = birthdate.getFullYear();
            const month = birthdate.getMonth() + 1;
            const day = birthdate.getDate();
            const hour = birthdate.getHours();

            // è®¡ç®—å…«å­—
            const yearStem = getYearStem(year);
            const yearBranch = getYearBranch(year);
            const monthStem = getMonthStem(yearStem, month);
            const monthBranch = getMonthBranch(month);
            const dayStem = getDayStem(year, month, day);
            const dayBranch = getDayBranch(year, month, day);
            const hourStem = getHourStem(dayStem, hour);
            const hourBranch = getHourBranch(hour);

            // è®¡ç®—äº”è¡Œåˆ†å¸ƒ
            const elements = [
                FIVE_ELEMENTS[yearStem], FIVE_ELEMENTS[yearBranch],
                FIVE_ELEMENTS[monthStem], FIVE_ELEMENTS[monthBranch],
                FIVE_ELEMENTS[dayStem], FIVE_ELEMENTS[dayBranch],
                FIVE_ELEMENTS[hourStem], FIVE_ELEMENTS[hourBranch]
            ];

            const elementCount = elements.reduce((acc, element) => {
                acc[element] = (acc[element] || 0) + 1;
                return acc;
            }, {});

            return {
                yearPillar: `${yearStem}${yearBranch}`,
                monthPillar: `${monthStem}${monthBranch}`,
                dayPillar: `${dayStem}${dayBranch}`,
                hourPillar: `${hourStem}${hourBranch}`,
                elements: elementCount
            };
        }

        // åˆ†æäº”è¡Œ
        function analyzeElements(elementCount) {
            const total = Object.values(elementCount).reduce((a, b) => a + b, 0);
            const analysis = {};
            
            // Convert Chinese element names to English
            const elementMap = {
                'é‡‘': 'metal',
                'æœ¨': 'wood',
                'æ°´': 'water',
                'ç«': 'fire',
                'åœŸ': 'earth'
            };
            
            // Convert counts to use English names
            const englishCount = {};
            for (const [element, count] of Object.entries(elementCount)) {
                englishCount[elementMap[element]] = count;
            }
            
            // Analyze all elements
            const allElements = ['metal', 'wood', 'water', 'fire', 'earth'];
            allElements.forEach(element => {
                const count = englishCount[element] || 0;
                const percentage = (count / total) * 100;
                
                if (percentage >= 35) analysis[element] = 'excess';
                else if (percentage >= 25) analysis[element] = 'strong';
                else if (percentage >= 15) analysis[element] = 'balanced';
                else if (percentage >= 5) analysis[element] = 'weak';
                else analysis[element] = 'missing';
            });
            
            return analysis;
        }

        // åˆ†æè¿åŠ¿
        function analyzeFortune(baziResult, gender) {
            const elements = baziResult.elements;
            const elementAnalysis = analyzeElements(elements);
            
            // åˆ†æäº”è¡Œç¼ºå¤±å’Œå¤ªè¿‡
            const weakElements = [];
            const strongElements = [];
            for (const [element, state] of Object.entries(elementAnalysis)) {
                if (state === 'missing' || state === 'weak') weakElements.push(element);
                if (state === 'excess') strongElements.push(element);
            }

            // è¿åŠ¿åˆ†æç»“æœ
            const fortune = {
                currentYear: {
                    overall: getOverallFortune(weakElements, strongElements),
                    career: getCareerFortune(weakElements, strongElements),
                    relationship: getRelationshipFortune(weakElements, strongElements, gender),
                    health: getHealthFortune(weakElements, strongElements),
                    wealth: getWealthFortune(weakElements, strongElements)
                },
                tenYears: generateTenYearsFortune(weakElements, strongElements)
            };

            // å•†å“æ¨è
            const recommendations = generateRecommendations(weakElements, strongElements);

            return { fortune, recommendations };
        }

        // ç”Ÿæˆæ€»ä½“è¿åŠ¿
        function getOverallFortune(weakElements, strongElements) {
            const fortunes = {
                'wood': {
                    zh: ['äº‹ä¸šå‘å±•', 'ä¸ªäººæˆé•¿'],
                    en: ['Career Development', 'Personal Growth']
                },
                'fire': {
                    zh: ['äººé™…å…³ç³»', 'åå£°åœ°ä½'],
                    en: ['Interpersonal Relations', 'Reputation']
                },
                'earth': {
                    zh: ['ç¨³å®šå‘å±•', 'è´¢è¿åŸºç¡€'],
                    en: ['Stable Development', 'Financial Foundation']
                },
                'metal': {
                    zh: ['è´¢è¿æ”¶è·', 'äººè„‰æ‹“å±•'],
                    en: ['Financial Gains', 'Network Expansion']
                },
                'water': {
                    zh: ['æ™ºæ…§åˆ›æ–°', 'å­¦ä¹ è¿›æ­¥'],
                    en: ['Wisdom & Innovation', 'Learning Progress']
                }
            };

            const prefix = currentLang === 'zh' ? 'ä»Šå¹´æ•´ä½“è¿åŠ¿ï¼š' : 'Overall Fortune This Year:';
            const weakPrefix = currentLang === 'zh' ? '\néœ€è¦æ³¨æ„ï¼š' : '\nAreas of Concern:';
            const strongPrefix = currentLang === 'zh' ? '\næœ‰åˆ©æ–¹å‘ï¼š' : '\nFavorable Directions:';
            const weakSuffix = currentLang === 'zh' ? 'æ–¹é¢å¯èƒ½é‡åˆ°æŒ‘æˆ˜ã€‚' : 'may face challenges.';
            const strongSuffix = currentLang === 'zh' ? 'æ–¹é¢ä¼šæœ‰è‰¯å¥½å‘å±•ã€‚' : 'will develop well.';

            let analysis = prefix;
            if (weakElements.length > 0) {
                analysis += weakPrefix + weakElements.map(e => fortunes[e][currentLang].join(currentLang === 'zh' ? 'ã€' : ' & ')).join(currentLang === 'zh' ? 'ï¼Œ' : ', ') + weakSuffix;
            }
            if (strongElements.length > 0) {
                analysis += strongPrefix + strongElements.map(e => fortunes[e][currentLang].join(currentLang === 'zh' ? 'ã€' : ' & ')).join(currentLang === 'zh' ? 'ï¼Œ' : ', ') + strongSuffix;
            }

            return analysis;
        }

        // ç”Ÿæˆäº‹ä¸šè¿åŠ¿
        function getCareerFortune(weakElements, strongElements) {
            const careerAdvice = {
                'wood': {
                    zh: 'åˆ›æ–°èƒ½åŠ›å’Œå†³ç­–åŠ›',
                    en: 'Innovation and Decision-making'
                },
                'fire': {
                    zh: 'é¢†å¯¼èƒ½åŠ›å’Œè¡¨ç°åŠ›',
                    en: 'Leadership and Expression'
                },
                'earth': {
                    zh: 'æ‰§è¡ŒåŠ›å’Œç¨³å®šæ€§',
                    en: 'Execution and Stability'
                },
                'metal': {
                    zh: 'ç®¡ç†èƒ½åŠ›å’Œè§„åˆ’åŠ›',
                    en: 'Management and Planning'
                },
                'water': {
                    zh: 'å­¦ä¹ èƒ½åŠ›å’Œåº”å˜åŠ›',
                    en: 'Learning and Adaptability'
                }
            };

            const prefix = currentLang === 'zh' ? 'äº‹ä¸šå‘å±•å»ºè®®ï¼š\n' : 'Career Development Advice:\n';
            const suggestionPrefix = currentLang === 'zh' ? 'å»ºè®®åŠ å¼ºï¼š' : 'Suggested improvements: ';

            let advice = prefix;
            if (weakElements.length > 0) {
                advice += suggestionPrefix + weakElements.map(e => careerAdvice[e][currentLang]).join(currentLang === 'zh' ? 'ã€' : ', ');
            }
            return advice;
        }

        // ç”Ÿæˆæ„Ÿæƒ…è¿åŠ¿
        function getRelationshipFortune(weakElements, strongElements, gender) {
            const relationshipAdvice = {
                male: {
                    'wood': {
                        zh: 'ä¸»åŠ¨è¡¨è¾¾æ„Ÿæƒ…',
                        en: 'Express Feelings Actively'
                    },
                    'fire': {
                        zh: 'å¢åŠ ç¤¾äº¤æ´»åŠ¨',
                        en: 'Increase Social Activities'
                    },
                    'earth': {
                        zh: 'å±•ç°è´£ä»»æ‹…å½“',
                        en: 'Show Responsibility'
                    },
                    'metal': {
                        zh: 'æå‡ä¸ªäººé­…åŠ›',
                        en: 'Enhance Personal Charm'
                    },
                    'water': {
                        zh: 'åŸ¹å…»æ„Ÿæƒ…æ™ºæ…§',
                        en: 'Cultivate Emotional Wisdom'
                    }
                },
                female: {
                    'wood': {
                        zh: 'ä¿æŒç‹¬ç«‹ä¸ªæ€§',
                        en: 'Maintain Independence'
                    },
                    'fire': {
                        zh: 'å±•ç°ä¸ªäººé­…åŠ›',
                        en: 'Show Personal Charm'
                    },
                    'earth': {
                        zh: 'è¥é€ æ¸©é¦¨æ°›å›´',
                        en: 'Create Warm Atmosphere'
                    },
                    'metal': {
                        zh: 'æå‡æ°”è´¨ä¿®å…»',
                        en: 'Enhance Temperament'
                    },
                    'water': {
                        zh: 'å¢è¿›æƒ…æ„Ÿäº¤æµ',
                        en: 'Improve Emotional Communication'
                    }
                }
            };

            const prefix = currentLang === 'zh' ? 'æ„Ÿæƒ…è¿åŠ¿å»ºè®®ï¼š\n' : 'Relationship Advice:\n';
            const suggestionPrefix = currentLang === 'zh' ? 'å»ºè®®ï¼š' : 'Suggestions: ';

            const advice = gender === 'male' ? relationshipAdvice.male : relationshipAdvice.female;
            let analysis = prefix;
            if (weakElements.length > 0) {
                analysis += suggestionPrefix + weakElements.map(e => advice[e][currentLang]).join(currentLang === 'zh' ? 'ã€' : ', ');
            }
            return analysis;
        }

        // ç”Ÿæˆå¥åº·è¿åŠ¿
        function getHealthFortune(weakElements, strongElements) {
            const healthAdvice = {
                'wood': {
                    zh: ['è‚èƒ†ç³»ç»Ÿ', 'çœ¼ç›', 'ç­‹ç»œ'],
                    en: ['Liver & Gallbladder', 'Eyes', 'Tendons']
                },
                'fire': {
                    zh: ['å¿ƒè„‘è¡€ç®¡', 'æƒ…ç»ª', 'ç¡çœ '],
                    en: ['Cardiovascular', 'Emotions', 'Sleep']
                },
                'earth': {
                    zh: ['æ¶ˆåŒ–ç³»ç»Ÿ', 'è¥å…»', 'ä»£è°¢'],
                    en: ['Digestive System', 'Nutrition', 'Metabolism']
                },
                'metal': {
                    zh: ['å‘¼å¸ç³»ç»Ÿ', 'çš®è‚¤', 'å…ç–«'],
                    en: ['Respiratory', 'Skin', 'Immunity']
                },
                'water': {
                    zh: ['æ³Œå°¿ç³»ç»Ÿ', 'è€³æœµ', 'éª¨éª¼'],
                    en: ['Urinary System', 'Ears', 'Bones']
                }
            };

            const prefix = currentLang === 'zh' ? 'å¥åº·æ³¨æ„äº‹é¡¹ï¼š\n' : 'Health Considerations:\n';
            const attentionPrefix = currentLang === 'zh' ? 'éœ€è¦å…³æ³¨ï¼š' : 'Pay attention to: ';

            let advice = prefix;
            if (weakElements.length > 0) {
                advice += attentionPrefix + weakElements.map(e => healthAdvice[e][currentLang].join(currentLang === 'zh' ? 'ã€' : ', ')).join(currentLang === 'zh' ? 'ï¼Œ' : '; ');
            }
            return advice;
        }

        // ç”Ÿæˆè´¢è¿åˆ†æ
        function getWealthFortune(weakElements, strongElements) {
            const wealthAdvice = {
                'wood': {
                    zh: 'é€‚åˆæŠ•èµ„åˆ›ä¸š',
                    en: 'Suitable for Investment & Entrepreneurship'
                },
                'fire': {
                    zh: 'é€‚åˆå¸‚åœºè¥é”€',
                    en: 'Suitable for Marketing'
                },
                'earth': {
                    zh: 'é€‚åˆæˆ¿åœ°äº§æŠ•èµ„',
                    en: 'Suitable for Real Estate Investment'
                },
                'metal': {
                    zh: 'é€‚åˆç†è´¢è§„åˆ’',
                    en: 'Suitable for Financial Planning'
                },
                'water': {
                    zh: 'é€‚åˆåˆ›æ–°é¡¹ç›®',
                    en: 'Suitable for Innovative Projects'
                }
            };

            const prefix = currentLang === 'zh' ? 'è´¢è¿å‘å±•å»ºè®®ï¼š\n' : 'Wealth Development Advice:\n';
            const favorablePrefix = currentLang === 'zh' ? 'æœ‰åˆ©æ–¹å‘ï¼š' : 'Favorable directions: ';

            let advice = prefix;
            if (strongElements.length > 0) {
                advice += favorablePrefix + strongElements.map(e => wealthAdvice[e][currentLang]).join(currentLang === 'zh' ? 'ã€' : ', ');
            }
            return advice;
        }

        // ç”Ÿæˆæœªæ¥åå¹´è¿åŠ¿
        function generateTenYearsFortune(weakElements, strongElements) {
            const currentYear = new Date().getFullYear();
            const tenYears = [];
            
            const seasonalAdvice = {
                'wood': {
                    zh: 'å®œåœ¨æ˜¥å­£å¼€å±•äº‹ä¸š',
                    en: 'Career development is favorable in Spring'
                },
                'fire': {
                    zh: 'å¤å­£æ³¨æ„æŠŠæ¡æœºä¼š',
                    en: 'Watch for opportunities in Summer'
                },
                'earth': {
                    zh: 'å­£èŠ‚äº¤æ›¿æ—¶æœŸå®œç¨³å¥å‘å±•',
                    en: 'Steady development during seasonal transitions'
                },
                'metal': {
                    zh: 'ç§‹å­£è´¢è¿è¾ƒå¥½',
                    en: 'Good financial fortune in Autumn'
                },
                'water': {
                    zh: 'å†¬å­£é€‚åˆå­¦ä¹ è¿›ä¿®',
                    en: 'Good for learning and self-improvement in Winter'
                }
            };

            for (let i = 0; i < 10; i++) {
                const year = currentYear + i;
                const yearLuck = {
                    year: year,
                    overall: Math.floor(Math.random() * 100),
                    career: Math.floor(Math.random() * 100),
                    relationship: Math.floor(Math.random() * 100),
                    wealth: Math.floor(Math.random() * 100),
                    highlights: []
                };

                // Add seasonal advice based on weak elements
                weakElements.forEach(element => {
                    yearLuck.highlights.push(seasonalAdvice[element][currentLang]);
                });

                tenYears.push(yearLuck);
            }

            return tenYears;
        }

        // ç”Ÿæˆå•†å“æ¨è
        function generateRecommendations(weakElements, strongElements) {
            const products = {
                'æœ¨': [
                    {
                        name: 'Natural Green Jade Crystal Bracelet',
                        chineseName: 'å¤©ç„¶ç¿¡ç¿ æ‰‹é“¾',
                        description: 'Enhances growth energy and decision-making abilities',
                        chineseDesc: 'æå‡ç”Ÿé•¿èƒ½é‡ï¼Œå¢å¼ºå†³ç­–èƒ½åŠ›',
                        price: 39.99,
                        currency: 'USD',
                        link: 'https://www.amazon.com/dp/B0EXAMPLE1',
                        image: 'assets/products/wood1.jpg',
                        platform: 'Amazon'
                    },
                    {
                        name: 'Premium Bamboo Feng Shui Set',
                        chineseName: 'é«˜çº§ç«¹åˆ¶é£æ°´å¥—è£…',
                        description: 'Traditional feng shui tools for growth and prosperity',
                        chineseDesc: 'ä¼ ç»Ÿé£æ°´å·¥å…·ï¼ŒåŠ©åŠ›æˆé•¿ä¸ç¹è£',
                        price: 89.99,
                        currency: 'USD',
                        link: 'https://www.etsy.com/listing/EXAMPLE1',
                        image: 'assets/products/wood2.jpg',
                        platform: 'Etsy'
                    }
                ],
                'ç«': [
                    {
                        name: 'Red Agate Protection Bracelet',
                        chineseName: 'çº¢ç›ç‘™å®ˆæŠ¤æ‰‹é“¾',
                        description: 'Enhances personal charisma and leadership',
                        chineseDesc: 'æå‡ä¸ªäººé­…åŠ›ä¸é¢†å¯¼åŠ›',
                        price: 45.99,
                        currency: 'USD',
                        link: 'https://www.amazon.com/dp/B0EXAMPLE2',
                        image: 'assets/products/fire1.jpg',
                        platform: 'Amazon'
                    },
                    {
                        name: 'Carnelian Crystal Necklace',
                        chineseName: 'çº¢çº¹çŸ³æ°´æ™¶é¡¹é“¾',
                        description: 'Boosts confidence and creative energy',
                        chineseDesc: 'å¢å¼ºè‡ªä¿¡ä¸åˆ›é€ åŠ›',
                        price: 59.99,
                        currency: 'USD',
                        link: 'https://www.etsy.com/listing/EXAMPLE2',
                        image: 'assets/products/fire2.jpg',
                        platform: 'Etsy'
                    }
                ],
                'åœŸ': [
                    {
                        name: 'Citrine Wealth Bowl',
                        chineseName: 'é»„æ°´æ™¶èšå®ç›†',
                        description: 'Attracts abundance and stabilizes fortune',
                        chineseDesc: 'æ‹›è´¢çº³ç¦ï¼Œç¨³å®šè¿åŠ¿',
                        price: 79.99,
                        currency: 'USD',
                        link: 'https://www.amazon.com/dp/B0EXAMPLE3',
                        image: 'assets/products/earth1.jpg',
                        platform: 'Amazon'
                    },
                    {
                        name: 'Tiger Eye Protection Stone Set',
                        chineseName: 'è™çœ¼çŸ³å®ˆæŠ¤å¥—è£…',
                        description: 'Enhances determination and willpower',
                        chineseDesc: 'å¢å¼ºå†³å¿ƒä¸æ„å¿—åŠ›',
                        price: 49.99,
                        currency: 'USD',
                        link: 'https://www.etsy.com/listing/EXAMPLE3',
                        image: 'assets/products/earth2.jpg',
                        platform: 'Etsy'
                    }
                ],
                'é‡‘': [
                    {
                        name: 'Clear Quartz Meditation Crystal',
                        chineseName: 'ç™½æ°´æ™¶å†¥æƒ³æ°´æ™¶',
                        description: 'Amplifies energy and enhances clarity',
                        chineseDesc: 'å¢å¼ºèƒ½é‡ï¼Œæå‡æ¸…æ™°åº¦',
                        price: 69.99,
                        currency: 'USD',
                        link: 'https://www.amazon.com/dp/B0EXAMPLE4',
                        image: 'assets/products/metal1.jpg',
                        platform: 'Amazon'
                    },
                    {
                        name: 'Rutilated Quartz Bracelet',
                        chineseName: 'é’›æ™¶æ‰‹é“¾',
                        description: 'Strengthens willpower and manifestation',
                        chineseDesc: 'å¼ºåŒ–æ„å¿—åŠ›ä¸å®ç°åŠ›',
                        price: 89.99,
                        currency: 'USD',
                        link: 'https://www.etsy.com/listing/EXAMPLE4',
                        image: 'assets/products/metal2.jpg',
                        platform: 'Etsy'
                    }
                ],
                'æ°´': [
                    {
                        name: 'Moonstone Healing Crystal Set',
                        chineseName: 'æœˆå…‰çŸ³ç–—æ„ˆå¥—è£…',
                        description: 'Enhances intuition and emotional balance',
                        chineseDesc: 'å¢å¼ºç›´è§‰ä¸æƒ…æ„Ÿå¹³è¡¡',
                        price: 55.99,
                        currency: 'USD',
                        link: 'https://www.amazon.com/dp/B0EXAMPLE5',
                        image: 'assets/products/water1.jpg',
                        platform: 'Amazon'
                    },
                    {
                        name: 'Blue Lace Agate Crystal Pendant',
                        chineseName: 'è“çº¹ç›ç‘™æ°´æ™¶åŠå ',
                        description: 'Promotes calm and clear communication',
                        chineseDesc: 'ä¿ƒè¿›å¹³é™ä¸æ¸…æ™°æ²Ÿé€š',
                        price: 65.99,
                        currency: 'USD',
                        link: 'https://www.etsy.com/listing/EXAMPLE5',
                        image: 'assets/products/water2.jpg',
                        platform: 'Etsy'
                    }
                ]
            };

            const recommendations = [];
            
            // ä¸ºç¼ºå¤±å’Œåå¼±çš„äº”è¡Œæ¨èäº§å“
            weakElements.forEach(element => {
                if (products[element]) {
                    recommendations.push({
                        element: element,
                        reason: `Supplement ${element} element to enhance fortune`,
                        chineseReason: `è¡¥å……${element}å…ƒç´ ï¼Œå¢å¼ºè¿åŠ¿`,
                        products: products[element]
                    });
                }
            });

            return recommendations;
        }

        // é‡ç½®è¡¨å•
        function resetForm() {
            document.getElementById('baziForm').reset();
            localStorage.removeItem('baziFormData');
            document.getElementById('result').classList.remove('active');
            
            // é‡ç½®ä¸ºå½“å‰æ—¶é—´
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            
            document.getElementById('birthdate').value = `${year}-${month}-${day}T${hours}:${minutes}`;
        }

        // Language switching functions
        function toggleLanguageOptions() {
            const options = document.getElementById('languageOptions');
            options.classList.toggle('show');
            
            // Close the language options when clicking outside
            document.addEventListener('click', function closeLanguageOptions(e) {
                if (!e.target.closest('.language-selector')) {
                    options.classList.remove('show');
                    document.removeEventListener('click', closeLanguageOptions);
                }
            });
        }

        function changeLanguage(lang) {
            currentLang = lang;
            document.documentElement.lang = lang;
            
            // Update language button text
            const currentLangText = document.querySelector('.current-lang-text');
            currentLangText.textContent = lang === 'en' ? 'English' : 'ä¸­æ–‡';
            
            // Hide language options
            document.getElementById('languageOptions').classList.remove('show');
            
            // Update page content
            updatePageLanguage();
            
            // Save language preference
            localStorage.setItem('preferredLanguage', lang);
        }

        // Initialize language settings
        document.addEventListener('DOMContentLoaded', function() {
            // Set default language to English if no preference is saved
            const savedLang = localStorage.getItem('preferredLanguage') || 'en';
            changeLanguage(savedLang);

            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            
            document.getElementById('birthdate').value = `${year}-${month}-${day}T${hours}:${minutes}`;

            // æ¢å¤ä¿å­˜çš„æ•°æ®
            const savedData = localStorage.getItem('baziFormData');
            if (savedData) {
                const data = JSON.parse(savedData);
                document.getElementById('birthdate').value = data.birthdate;
                document.getElementById('gender').value = data.gender;
            }
        });

        // Form submission handler
        document.getElementById('baziForm').addEventListener('submit', function(event) {
            event.preventDefault();
            
            const birthdate = new Date(document.getElementById('birthdate').value);
            const gender = document.getElementById('gender').value;

            // Validate date range
            const minDate = new Date('1900-01-01');
            const maxDate = new Date('2100-12-31');
            if (birthdate < minDate || birthdate > maxDate) {
                alert(i18n[currentLang].validation_date);
                return;
            }

            // Validate gender selection
            if (!gender) {
                alert(i18n[currentLang].validation_gender);
                return;
            }

            generateAndDisplayResult(birthdate, gender);

            // Save to localStorage
            localStorage.setItem('baziFormData', JSON.stringify({
                birthdate: document.getElementById('birthdate').value,
                gender: gender
            }));
        });

        // Result generation and display function
        function generateAndDisplayResult(birthdate, gender) {
            const baziResult = analyzeBaZi(birthdate);
            const elementAnalysis = analyzeElements(baziResult.elements);
            const { fortune, recommendations } = analyzeFortune(baziResult, gender);
            const traditionalDate = generateTraditionalDate(birthdate);

            // Display results
            const resultSection = document.getElementById('result');
            resultSection.innerHTML = `
                <h2 class="result-title">${i18n[currentLang].result_title}</h2>
                <div class="result-content">
                    <div class="result-item traditional-date">
                        <h3>${i18n[currentLang].birth_time}</h3>
                        <div class="date-line year-line">
                            <span class="date-label">${i18n[currentLang].year_label}</span>
                            <span class="date-value">${traditionalDate.yearText}</span>
                        </div>
                        <div class="date-line month-line">
                            <span class="date-label">${i18n[currentLang].month_label}</span>
                            <span class="date-value">${traditionalDate.monthText}</span>
                        </div>
                        <div class="date-line day-line">
                            <span class="date-label">${i18n[currentLang].day_label}</span>
                            <span class="date-value">${traditionalDate.dayText}</span>
                        </div>
                        <div class="date-line hour-line">
                            <span class="date-label">${i18n[currentLang].hour_label}</span>
                            <span class="date-value">${traditionalDate.hourText}</span>
                        </div>
                        <div class="gender-line">
                            <span class="date-label">${i18n[currentLang].gender_label}</span>
                            <span class="date-value">${gender === 'male' ? i18n[currentLang].gender_result_male : i18n[currentLang].gender_result_female}</span>
                        </div>
                    </div>
                    
                    <div class="result-item">
                        <h3>${i18n[currentLang].bazi_title}</h3>
                        <p>${i18n[currentLang].year_pillar}ï¼š${baziResult.yearPillar}</p>
                        <p>${i18n[currentLang].month_pillar}ï¼š${baziResult.monthPillar}</p>
                        <p>${i18n[currentLang].day_pillar}ï¼š${baziResult.dayPillar}</p>
                        <p>${i18n[currentLang].hour_pillar}ï¼š${baziResult.hourPillar}</p>
                    </div>

                    <div class="result-item">
                        <h3>${i18n[currentLang].five_elements}</h3>
                        ${Object.entries(elementAnalysis).map(([element, state]) => {
                            const elementKey = 'element_' + element;
                            const statusKey = 'element_status_' + state;
                            return `<p>${i18n[currentLang][elementKey]}ï¼š${i18n[currentLang][statusKey]}</p>`;
                        }).join('')}
                    </div>

                    <div class="result-item">
                        <h3>${i18n[currentLang].current_fortune}</h3>
                        <p>${fortune.currentYear.overall}</p>
                        <p>${fortune.currentYear.career}</p>
                        <p>${fortune.currentYear.relationship}</p>
                        <p>${fortune.currentYear.health}</p>
                        <p>${fortune.currentYear.wealth}</p>
                    </div>

                    <div class="result-item">
                        <h3>${i18n[currentLang].ten_years}</h3>
                        <div class="fortune-timeline">
                            ${fortune.tenYears.map(yearLuck => `
                                <div class="year-fortune">
                                    <h4>${yearLuck.year}${currentLang === 'zh' ? 'å¹´' : ''}</h4>
                                    <div class="fortune-stats">
                                        <div class="stat">
                                            <span>${i18n[currentLang].overall}ï¼š${yearLuck.overall}%</span>
                                            <div class="progress-bar">
                                                <div class="progress" style="width: ${yearLuck.overall}%"></div>
                                            </div>
                                        </div>
                                        <div class="stat">
                                            <span>${i18n[currentLang].career}ï¼š${yearLuck.career}%</span>
                                            <div class="progress-bar">
                                                <div class="progress" style="width: ${yearLuck.career}%"></div>
                                            </div>
                                        </div>
                                        <div class="stat">
                                            <span>${i18n[currentLang].relationship}ï¼š${yearLuck.relationship}%</span>
                                            <div class="progress-bar">
                                                <div class="progress" style="width: ${yearLuck.relationship}%"></div>
                                            </div>
                                        </div>
                                        <div class="stat">
                                            <span>${i18n[currentLang].wealth}ï¼š${yearLuck.wealth}%</span>
                                            <div class="progress-bar">
                                                <div class="progress" style="width: ${yearLuck.wealth}%"></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="year-highlights">
                                        ${yearLuck.highlights.map(highlight => `<p>â€¢ ${highlight}</p>`).join('')}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
            
            resultSection.classList.add('active');
            resultSection.scrollIntoView({ behavior: 'smooth' });
        }
    </script>
</body>
</html> 